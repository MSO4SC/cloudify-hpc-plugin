plugins:
  # Name could be anything, this name is what appears on the beginning of operation
  # mappings.
  hpc:
    # Could be 'central_deployment_agent' or 'host_agent'.
    # If 'central_deployment_agent', this plugin will be executed on the
    # deployment dedicated agent, other wise it will be executed on the host agent.
    executor: central_deployment_agent

    # URL to archive containing the plugin or name of directory containing
    # the plugin if it is included in the the blueprint directory under the
    # "plugins" directory.
    source: https://github.com/MSO4SC/cloudify-hpc-plugin/archive/master.zip

node_types:
    hpc.nodes.slurm:
        derived_from: cloudify.nodes.Compute
        properties:
            credentials:
                description: file in which ssh connection credentials are stored
                type: string
            agent_config:
                default:
                    install_method: none
        interfaces:
            cloudify.interfaces.lifecycle:
                start:
                    implementation: hpc.hpc_plugin.tasks.login_connection
                    inputs:
                        credentials_path:
                            default: { get_property: [SELF, credentials] }

    hpc.nodes.job:
        derived_from: cloudify.nodes.Root
        properties:
            command:
                type: string
        interfaces:
            cloudify.interfaces.lifecycle:
                start:
                    implementation: hpc.hpc_plugin.tasks.send_job
                    inputs:
                        _command:
                            default: { get_property: [SELF, command] }

relationships:
    job_contained_in_hpc:
        derived_from: cloudify.relationships.contained_in
        source_interfaces:
            cloudify.interfaces.relationship_lifecycle:
                preconfigure:
                    implementation: hpc.hpc_plugin.tasks.preconfigure_job
                    inputs:
                        credentials_path: 
                            default: { get_property: [TARGET, credentials] }
